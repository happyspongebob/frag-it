# 进度文档（完成追踪）

## 项目信息
- **项目**：情绪缓冲型单页网站（MVP）
- **目标**：允许用户暂时不面对现实、喘一口气（30–60 秒体验）

## 文件清单
- Vite 项目（React + TypeScript）
- `src/App.tsx`：主应用组件（状态机/页面组装）
- `src/components/ShatterEffect.tsx`：粉碎动画组件
- `src/components/ComfortMessage.tsx`：智能安慰 + 积极肯定组件
- `任务文档.md`（已完成）：需求与整体规划
- `进度文档.md`（本文件）：完成追踪

## 已完成（Done）
### 1) 单页 MVP 已实现
- **Hero 模块**：
  - 主文案：你不需要立刻面对一切。
  - 副标题：这里不是让你变好，是让你先轻一点。
- **输入区**：
  - 文本输入（placeholder：现在压在你身上的事情是……）
  - 主按钮：把它放下来
- **粉碎交互区**：
  - 点击按钮后输入区淡出、粉碎区淡入
  - 输入内容以卡片形式展示
  - 碎裂/解体动画（卡片淡出 + 碎片飞散）
  - 页面不跳转
- **情绪缓冲文案展示区**：
  - 粉碎结束后随机展示文案池的一条
  - 缓慢淡入
- **轻量出口区**：
  - 底部淡淡出现 3 个出口选项（仅展示）

### 2) 视觉与动效基调
- 暖色低饱和渐变背景（奶油米色/浅杏/暖橙）
- 大量留白、圆角卡片与按钮
- 动画节奏偏慢、克制
- 支持 `prefers-reduced-motion: reduce`

### 3) 可用性
- 页面加载后自动聚焦输入框
- 支持 `Ctrl+Enter` / `Cmd+Enter` 提交

## 待确认 / 可选优化（Backlog）
- **可选**：粉碎表现再“像文字碎裂”（目前为碎片飞散 + 卡片消散）
- **可选**：增加“再放下一件”按钮以便重复体验（不改变产品态度的前提下）
- **可选**：更细腻的音效（默认不加，避免刺激；如要加需可关闭）

## 变更记录
- **V1｜2026-02-25**：初始化
  - 创建 `index.html`（完整 MVP）
  - 创建 `任务文档.md` 与 `进度文档.md`
- **V2｜2026-02-25 06:40**：迭代交互与文案
  - 粉碎动画升级为“文字拆解彩色碎片 + 粒子爆炸”
  - 新增“智能安慰”：按输入内容类别（工作/社交/感情/学业/家庭/通用）匹配文案池
  - 新增“积极肯定”：粉碎后额外显示一条轻量正向肯定语
- **V3｜2026-02-25 11:53**：技术栈迁移与三态单页
  - 技术栈升级为 React + TypeScript + Vite + Tailwind CSS + Framer Motion
  - 三态流程：input → crushing → result（单页切换不跳转）
  - 粉碎中态：显示“正在粉碎中...”并播放粒子/碎片飞溅
  - 结果态：展示已粉碎内容 + 智能安慰 + 积极肯定，并可“粉碎新的烦恼”重复使用
- **V4｜2026-02-25 12:23**：碎纸机动效与音效
  - 粉碎中动效升级为“碎纸机”竖向纸条下落消散
  - 加入撕纸/碎纸音效播放（需提供 `public/sfx/tear.mp3`）与音效开关
- **V5｜2026-02-25 12:50**：视觉与粉碎质感升级
  - 整体配色调整为更淡的浅杏/奶油米白系，减少橙感
  - 延长 crushing 停留时长（约 4200ms），并拉长条状碎纸掉落时间（约 2.4~3.2s）
  - 粉碎表现增强：加入更明显的碎纸堆堆积（卡片底部靠近边缘）与粒子爆炸飞溅（不断消散）
  - 粒子可见性增强：粒子尺寸与亮度提高，并提升层级避免被纸条覆盖
- **V6｜2026-02-25 23:08**：轻量后续出口落地
  - 结果页新增“轻量后续出口”：淡入显示、非主 CTA，并调整为位于“粉碎新的烦恼”按钮下方的三个次级按钮，仅呈现不记录、不提醒、不打卡
- **V7｜2026-02-25 23:25**：拖拽粉碎入口
  - 输入态新增“拖拽烦恼卡片到粉碎区（Drop Zone）松手触发粉碎”，并与按钮触发共用同一套粉碎逻辑

- **V8｜2026-02-26 00:36**：粉碎仪式感与呼吸感升级
  - 新增四态流程：input → preCrush → crushing → result
  - preCrush 阶段加入“蓄力/震动”反馈，让文字先抖动再进入粉碎
  - 新增 Canvas 文本采样粒子飘散覆盖层，让“烦恼文字”碎裂成极小粒子向四周飘散
  - 背景加入极轻微“呼吸”起伏（支持减少动画偏好）
  - 结果页安慰文案约 3 秒慢速渐显，积极肯定错峰出现

## 当前版本摘要（Latest）
- **版本**：V8｜2026-02-26 00:36
- **技术栈**：React + TypeScript + Vite + Tailwind CSS + Framer Motion
- **流程**：input → preCrush → crushing → result（可重复使用）
- **动效**：preCrush 蓄力/震动 + Canvas 文字粒子碎裂飘散覆盖层 + 碎纸机竖向纸条下落消散与碎纸堆堆积（支持减少动画偏好）
- **音效**：可选撕纸/碎纸音效（可开关）
- **视觉**：浅杏/奶油米白淡色系（更雾面、更克制）
- **文案**：智能安慰（分类匹配；约 3 秒慢速渐显）+ 积极肯定（错峰渐显）
- **出口**：结果页提供轻量后续出口（不强制；位于“粉碎新的烦恼”按钮下方的三个次级按钮；仅展示不记录）
- **交互**：支持拖拽烦恼卡片到粉碎区触发粉碎（点击按钮入口仍保留）

## AI 安慰生成（规划：里程碑 1 /api/comfort）
- **目标**：新增后端接口 `/api/comfort` 调用通义千问 OpenAI 兼容 Chat Completions，产出严格 JSON（`comfort` 为 2–4 句数组）
- **默认模型**：`qwen-plus`
- **base_url**：`https://dashscope.aliyuncs.com/compatible-mode/v1`
- **HTTP**：`POST https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions`
- **API Key 环境变量**：`DASHSCOPE_API_KEY`

### system 提示词（固定）
```text
你是一名温柔、可靠的安慰文案助手，为一个“粉碎烦恼”的网页应用生成短文案。

你的任务：
- 读取用户的一句话烦恼内容
- 输出：
  1) comfort：2-4 句安慰（数组，每个元素是一句完整句子）
  2) affirmation：1 句简短积极肯定
  3) category：1 个分类标签

语气要求：
- 温柔、接地气、不评判，尽量具体贴合用户烦恼
- 不要说教，不要空泛鸡汤
- 不要向用户提问
- 不要使用表情符号
- 不要使用列表、编号或项目符号
- 不要提到“我是 AI/模型/系统提示/政策”等内容

输出必须严格遵守（非常重要）：
- 只能输出且必须输出：一个合法的 JSON 对象
- JSON 之外不得出现任何字符（不能有解释、不能有 Markdown、不能有代码块）
- 所有 key 和字符串 value 必须使用英文双引号
- 不能有多余逗号
- 句子字符串内部不要包含换行符

输出 JSON 结构（必须完全一致）：
{
  "version": "comfort.v1",
  "language": "<BCP47 语言标签，例如 zh-CN>",
  "category": "<字符串>",
  "comfort": ["<句子1>", "<句子2>", "<句子3?>", "<句子4?>"],
  "affirmation": "<字符串>",
  "tags": ["<字符串>", "<字符串>", "<字符串?>", "<字符串?>", "<字符串?>", "<字符串?>"],
  "sql_hint": {
    "topic": "<字符串或空字符串>",
    "emotion": "<字符串或空字符串>",
    "severity": "<字符串或空字符串>",
    "entities": ["<字符串>", "<字符串?>", "<字符串?>", "<字符串?>"]
  },
  "ext": {
    "clientId": "<字符串或空字符串>",
    "requestId": "<字符串或空字符串>",
    "debug": {
      "model": "<字符串或空字符串>",
      "finish_reason": "<字符串或空字符串>"
    }
  }
}

字段规则：
- comfort：数组长度必须为 2-4；每个元素只能是一句完整句子（不要合并成一长段）
- affirmation：简短有力，中文建议 8-20 个字
- category：必须从用户消息给定的分类集合中选择且只能选 1 个
- tags：2-6 个简短标签（词/短语），不要写成句子
- sql_hint：为未来数据库/SQL 预留。不要瞎编，不确定就用空字符串/更短数组
- ext：为未来扩展预留。clientId/requestId 原样回显（没有就空字符串）
- ext.debug.model 与 ext.debug.finish_reason 必须输出空字符串（服务端会填充）
```

### user 提示词（每次请求动态拼）
```text
输入信息：
- problem（烦恼原文）："{problem}"
- locale（期望语言，可空）："{locale}"（为空则根据 problem 自动判断）
- clientId："{clientId}"
- requestId："{requestId}"

分类集合（必须且只能选 1 个）：
- relationship（关系/亲密/社交）
- work_study（工作/学习/考试）
- family（家庭）
- health（健康/睡眠/身体）
- money（经济）
- self_worth（自我价值/内疚/羞耻）
- future（未来/不确定/选择）
- stress（压力/焦虑/情绪泛化）
- other（其他）

要求：
- 只输出 1 个 JSON 对象，必须完全符合 system 中给定的结构
- language：填写你实际使用的语言标签（例如 "zh-CN"）
- comfort：必须为 2-4 句，数组逐句输出；每句不要换行
- 内容尽量贴合 problem，避免套话
- 不要提问
- ext.clientId / ext.requestId：原样回显输入（缺失则空字符串）
- ext.debug.model / ext.debug.finish_reason：输出空字符串

现在开始输出 JSON：
```

### 示例输出（用于验收 JSON 结构；内容仅为示例）
- **示例输入 problem**："明天要交项目，但我一点都没开始，我很慌。"
- **示例输入 locale**："zh-CN"
- **示例分类预期**：`work_study`

```json
{
  "version": "comfort.v1",
  "language": "zh-CN",
  "category": "work_study",
  "comfort": [
    "你现在的慌张很正常，因为你在意这件事，也知道它不轻。",
    "先别逼自己把整件事想完，把它拆成一个最小动作会更容易开始。",
    "哪怕只完成一点点，也是在把失控感慢慢收回来。"
  ],
  "affirmation": "你可以先做一小步。",
  "tags": ["deadline", "项目", "焦虑", "拆解", "开始"],
  "sql_hint": {
    "topic": "",
    "emotion": "",
    "severity": "",
    "entities": []
  },
  "ext": {
    "clientId": "",
    "requestId": "",
    "debug": {
      "model": "",
      "finish_reason": ""
    }
  }
}
```

## GitHub 上传 / 推送指令
> 以下命令在项目根目录执行（包含 `package.json` 的目录）。

### 首次上传（本地尚未初始化为 git 仓库）
1. 初始化仓库
   - `git init`
2. 添加并提交
   - `git add .`
   - `git commit -m "feat: init frag-it"`
3. 绑定远端（将 URL 替换为你的仓库地址）
   - `git branch -M main`
   - `git remote add origin https://github.com/<yourname>/<repo>.git`
4. 推送
   - `git push -u origin main`

### 已有仓库（本地已经是 git 仓库）
1. 查看当前远端
   - `git remote -v`
2. 如果还没有 origin：添加远端
   - `git remote add origin https://github.com/<yourname>/<repo>.git`
3. 如果 origin 已存在但需要改地址：更新远端
   - `git remote set-url origin https://github.com/<yourname>/<repo>.git`
4. 提交并推送
   - `git add .`
   - `git commit -m "chore: update"`
   - `git push -u origin main`
